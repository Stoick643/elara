{% extends "base.html" %}

{% block title %}Assessment Results - Elara{% endblock %}

{% block extra_css %}
<style>
    .results-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
        max-width: 900px;
        margin: 0 auto;
    }
    
    .results-header {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        color: white;
        padding: 2rem;
        text-align: center;
    }
    
    .results-content {
        padding: 2rem;
    }
    
    .overall-score-section {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
        border: 2px solid rgba(99, 102, 241, 0.2);
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
        margin-bottom: 2rem;
    }
    
    .overall-score {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    
    .overall-score.excellent { color: #22c55e; }
    .overall-score.good { color: #84cc16; }
    .overall-score.fair { color: #eab308; }
    .overall-score.poor { color: #f59e0b; }
    .overall-score.critical { color: #ef4444; }
    
    .score-description {
        font-size: 1.1rem;
        color: #6b7280;
        margin-bottom: 1rem;
    }
    
    .balance-indicator {
        font-size: 0.9rem;
        color: #6b7280;
    }
    
    .scores-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .score-item {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .score-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .score-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .score-title {
        font-weight: 600;
        color: #374151;
        margin: 0;
        font-size: 1rem;
    }
    
    .score-value {
        font-size: 1.2rem;
        font-weight: bold;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        color: white;
    }
    
    .progress-bar-container {
        background: #e2e8f0;
        border-radius: 6px;
        height: 8px;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }
    
    .progress-bar {
        height: 100%;
        transition: width 0.5s ease;
        border-radius: 6px;
    }
    
    .score-1, .score-2 { background: #ef4444; }
    .score-3, .score-4 { background: #f59e0b; }
    .score-5, .score-6 { background: #eab308; }
    .score-7, .score-8 { background: #84cc16; }
    .score-9, .score-10 { background: #22c55e; }
    
    .insights-section {
        margin-top: 2rem;
    }
    
    .insight-box {
        margin-bottom: 1.5rem;
        border-radius: 12px;
        padding: 1.5rem;
    }
    
    .improvement-areas {
        background: rgba(239, 68, 68, 0.05);
        border: 1px solid rgba(239, 68, 68, 0.2);
    }
    
    .strong-areas {
        background: rgba(34, 197, 94, 0.05);
        border: 1px solid rgba(34, 197, 94, 0.2);
    }
    
    .neutral-areas {
        background: rgba(99, 102, 241, 0.05);
        border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .insight-title {
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .improvement-areas .insight-title { color: #dc2626; }
    .strong-areas .insight-title { color: #16a34a; }
    .neutral-areas .insight-title { color: #6366f1; }
    
    .area-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .area-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    
    .area-item:last-child {
        border-bottom: none;
    }
    
    .priority-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-weight: 500;
        text-transform: uppercase;
    }
    
    .priority-critical {
        background: rgba(239, 68, 68, 0.2);
        color: #dc2626;
    }
    
    .priority-high {
        background: rgba(245, 158, 11, 0.2);
        color: #d97706;
    }
    
    .priority-moderate {
        background: rgba(234, 179, 8, 0.2);
        color: #ca8a04;
    }
    
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid #e5e7eb;
    }
    
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 2rem;
    }
    
    .breadcrumb-item a {
        color: #6366f1;
        text-decoration: none;
    }
    
    .breadcrumb-item a:hover {
        text-decoration: underline;
    }
    
    .assessment-meta {
        background: #f8fafc;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 2rem;
        font-size: 0.9rem;
        color: #6b7280;
    }
    
    .notes-display {
        background: #f1f5f9;
        border-left: 4px solid #6366f1;
        padding: 1rem;
        margin-top: 1rem;
        border-radius: 0 8px 8px 0;
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{{ url_for('assessment.assessment_home') }}">
                <i class="bi bi-pie-chart"></i> Life Assessment
            </a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Results</li>
    </ol>
</nav>

<!-- Results Card -->
<div class="results-card">
    <!-- Header -->
    <div class="results-header">
        <h1><i class="bi bi-bar-chart"></i> Your Life Balance Results</h1>
        <p class="lead mb-0">Assessment completed on {{ assessment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
    </div>
    
    <!-- Results Content -->
    <div class="results-content">
        <!-- Assessment Metadata -->
        <div class="assessment-meta">
            <i class="bi bi-info-circle"></i> 
            This assessment reflects your current life satisfaction across 8 key areas. 
            Use these insights to identify areas for growth and maintain your strengths.
        </div>

        <!-- Overall Score Section -->
        <div class="overall-score-section">
            <div class="overall-score 
                {% if balance_data.overall_balance >= 8 %}excellent
                {% elif balance_data.overall_balance >= 6.5 %}good
                {% elif balance_data.overall_balance >= 5 %}fair
                {% elif balance_data.overall_balance >= 3 %}poor
                {% else %}critical{% endif %}">
                {{ balance_data.overall_balance }}/10
            </div>
            <div class="score-description">
                {% if balance_data.overall_balance >= 8 %}
                    Excellent life balance! You're thriving across most areas.
                {% elif balance_data.overall_balance >= 6.5 %}
                    Good life balance with room for targeted improvements.
                {% elif balance_data.overall_balance >= 5 %}
                    Fair balance. Focus on your lowest scoring areas.
                {% elif balance_data.overall_balance >= 3 %}
                    Several areas need attention to improve overall wellbeing.
                {% else %}
                    Critical areas require immediate focus for better life balance.
                {% endif %}
            </div>
            <div class="balance-indicator">
                Overall Life Balance Score
            </div>
        </div>

        <!-- Individual Scores Grid -->
        <div class="scores-grid">
            {% for area_name, score in scores_dict.items() %}
            <div class="score-item">
                <div class="score-header">
                    <h4 class="score-title">
                        {% if area_name == 'Career & Work' %}üè¢{% endif %}
                        {% if area_name == 'Health & Fitness' %}üí™{% endif %}
                        {% if area_name == 'Relationships' %}‚ù§Ô∏è{% endif %}
                        {% if area_name == 'Money & Finance' %}üí∞{% endif %}
                        {% if area_name == 'Personal Growth' %}üå±{% endif %}
                        {% if area_name == 'Fun & Recreation' %}üéâ{% endif %}
                        {% if area_name == 'Home Environment' %}üè†{% endif %}
                        {% if area_name == 'Purpose & Meaning' %}üéØ{% endif %}
                        {{ area_name }}
                    </h4>
                    <div class="score-value score-{{ score }}">{{ score }}/10</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar score-{{ score }}" style="width: {{ (score / 10 * 100) }}%"></div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Insights Section -->
        <div class="insights-section">
            {% if improvement_areas %}
            <!-- Areas Needing Attention -->
            <div class="insight-box improvement-areas">
                <h3 class="insight-title">
                    <i class="bi bi-exclamation-triangle"></i>
                    Areas Needing Attention ({{ improvement_areas|length }})
                </h3>
                <ul class="area-list">
                    {% for area in improvement_areas %}
                    <li class="area-item">
                        <span>{{ area.area }} ({{ area.score }}/10)</span>
                        <span class="priority-badge priority-{{ area.priority }}">{{ area.priority }}</span>
                    </li>
                    {% endfor %}
                </ul>
                <p class="mt-2 mb-0">
                    <strong>Recommendation:</strong> Focus on your {{ improvement_areas[0].priority }} priority areas first. 
                    Small, consistent improvements in these areas can significantly boost your overall life satisfaction.
                </p>
            </div>
            {% endif %}

            {% set strong_areas = balance_data.highest_areas %}
            {% if strong_areas %}
            <!-- Strong Areas -->
            <div class="insight-box strong-areas">
                <h3 class="insight-title">
                    <i class="bi bi-star"></i>
                    Your Strongest Areas
                </h3>
                <ul class="area-list">
                    {% for area_name, score in strong_areas %}
                    {% if score >= 7 %}
                    <li class="area-item">
                        <span>{{ area_name }}</span>
                        <span class="score-value score-{{ score }}">{{ score }}/10</span>
                    </li>
                    {% endif %}
                    {% endfor %}
                </ul>
                <p class="mt-2 mb-0">
                    <strong>Celebrate:</strong> These are your foundation areas! Consider how the skills and habits 
                    that make you successful here can be applied to areas that need improvement.
                </p>
            </div>
            {% endif %}

            {% set neutral_areas = [] %}
            {% for area_name, score in scores_dict.items() %}
                {% if score >= 5 and score < 7 %}
                    {% set _ = neutral_areas.append((area_name, score)) %}
                {% endif %}
            {% endfor %}

            {% if neutral_areas %}
            <!-- Neutral Areas -->
            <div class="insight-box neutral-areas">
                <h3 class="insight-title">
                    <i class="bi bi-arrow-up-circle"></i>
                    Growth Opportunities
                </h3>
                <ul class="area-list">
                    {% for area_name, score in neutral_areas %}
                    <li class="area-item">
                        <span>{{ area_name }}</span>
                        <span class="score-value score-{{ score }}">{{ score }}/10</span>
                    </li>
                    {% endfor %}
                </ul>
                <p class="mt-2 mb-0">
                    <strong>Next Level:</strong> These areas are doing okay but have potential for growth. 
                    Once you've addressed critical areas, these could be your next focus.
                </p>
            </div>
            {% endif %}
        </div>

        {% if assessment.notes %}
        <!-- Notes Display -->
        <div class="notes-display">
            <h4><i class="bi bi-journal-text"></i> Your Notes</h4>
            <p class="mb-0">{{ assessment.notes }}</p>
        </div>
        {% endif %}

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="{{ url_for('assessment.wheel_of_life') }}" class="btn btn-primary btn-lg">
                <i class="bi bi-arrow-repeat"></i> Take New Assessment
            </a>
            
            <a href="{{ url_for('assessment.assessment_history') }}" class="btn btn-outline-primary btn-lg">
                <i class="bi bi-clock-history"></i> View History
            </a>
            
            <a href="{{ url_for('dashboard.dashboard') }}" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-house"></i> Back to Dashboard
            </a>
            
            {% if improvement_areas %}
            <button class="btn btn-success btn-lg" onclick="suggestGoals()">
                <i class="bi bi-lightbulb"></i> Suggest Goals
            </button>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Goal suggestion function (placeholder for future Phase 3.2)
function suggestGoals() {
    const improvementAreas = {{ improvement_areas | tojson }};
    let suggestions = [];
    
    improvementAreas.forEach(area => {
        switch(area.area) {
            case 'Career & Work':
                suggestions.push('Set clear career development goals');
                break;
            case 'Health & Fitness':
                suggestions.push('Create a sustainable exercise routine');
                break;
            case 'Relationships':
                suggestions.push('Schedule regular time with loved ones');
                break;
            case 'Money & Finance':
                suggestions.push('Create a budget and savings plan');
                break;
            case 'Personal Growth':
                suggestions.push('Learn a new skill or take a course');
                break;
            case 'Fun & Recreation':
                suggestions.push('Plan regular leisure activities');
                break;
            case 'Home Environment':
                suggestions.push('Organize and improve your living space');
                break;
            case 'Purpose & Meaning':
                suggestions.push('Reflect on your values and life purpose');
                break;
        }
    });
    
    alert('Goal Suggestions:\n\n' + suggestions.slice(0, 3).map((s, i) => `${i + 1}. ${s}`).join('\n') + 
          '\n\nNote: Goal recommendation feature coming in Phase 3.2!');
}

// Animate progress bars on page load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        document.querySelectorAll('.progress-bar').forEach(bar => {
            bar.style.opacity = '1';
        });
    }, 500);
});
</script>
{% endblock %}