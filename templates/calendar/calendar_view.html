{% extends "base.html" %}

{% block title %}Execute Calendar - Elara{% endblock %}

{% block extra_css %}
<style>
    .calendar-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 2rem;
    }
    
    .calendar-table {
        table-layout: fixed;
    }
    
    .calendar-cell {
        height: 120px;
        width: 14.28%;
        padding: 4px;
        vertical-align: top;
        position: relative;
        border: 1px solid #e5e7eb;
    }
    
    .calendar-cell.today {
        background: rgba(102, 126, 234, 0.1);
        border: 2px solid #667eea;
    }
    
    .calendar-cell.other-month {
        background: #f8f9fa;
        color: #9ca3af;
    }
    
    .day-number {
        font-weight: bold;
        margin-bottom: 4px;
        font-size: 0.9rem;
    }
    
    .day-activities {
        font-size: 0.68rem;
        line-height: 1.1;
        margin-top: 2px;
    }
    
    /* Google Calendar-style activities */
    .cal-activity {
        margin: 1px 0;
        padding: 1px 3px;
        border-radius: 2px;
        cursor: pointer;
        border-left: 2px solid;
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.15s ease;
        font-size: 0.68rem;
    }
    
    .cal-activity:hover {
        background: rgba(255, 255, 255, 1);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transform: translateX(1px);
    }
    
    .cal-activity-content {
        display: flex;
        align-items: center;
        gap: 2px;
    }
    
    .cal-text {
        flex: 1;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
    }
    
    .cal-check {
        font-size: 0.7rem;
        width: 8px;
        text-align: center;
    }
    
    .cal-check.checked {
        color: #22c55e;
        font-weight: bold;
    }
    
    .cal-icon {
        font-size: 0.65rem;
    }
    
    .cal-progress {
        font-size: 0.6rem;
        color: #666;
        margin-left: auto;
    }
    
    /* Activity type colors */
    .cal-task {
        border-left-color: #3b82f6;
        color: #1e40af;
    }
    
    .cal-task.completed {
        border-left-color: #22c55e;
        color: #166534;
        opacity: 0.75;
    }
    
    .cal-task.completed .cal-text {
        text-decoration: line-through;
    }
    
    .cal-goal {
        border-left-color: #ec4899;
        color: #be185d;
        font-weight: 500;
    }
    
    .cal-habit {
        border-left-color: #f59e0b;
        color: #92400e;
    }
    
    .cal-journal {
        border-left-color: #8b5cf6;
        color: #7c3aed;
    }
    
    .cal-more {
        font-size: 0.6rem;
        color: #6b7280;
        text-align: center;
        padding: 1px;
        cursor: pointer;
        border-top: 1px dotted #d1d5db;
        margin-top: 2px;
    }
    
    .cal-more:hover {
        color: #374151;
        background: rgba(0,0,0,0.05);
    }
    
    .mood-indicator {
        position: absolute;
        top: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        font-size: 0.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .mood-great { background: #22c55e; }
    .mood-good { background: #84cc16; }
    .mood-okay { background: #fbbf24; }
    .mood-poor { background: #f97316; }
    .mood-bad { background: #ef4444; }
    
    .quick-actions {
        position: absolute;
        bottom: 2px;
        right: 2px;
        display: none;
    }
    
    .calendar-cell:hover .quick-actions {
        display: block;
    }
    
    .quick-btn {
        background: #667eea;
        color: white;
        border: none;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        font-size: 0.6rem;
        margin-left: 1px;
        cursor: pointer;
    }
    
    .legend {
        display: flex;
        gap: 1rem;
        margin: 1rem 0;
        flex-wrap: wrap;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
    }
    
    .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="calendar-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="bi bi-calendar-event"></i> Execute Calendar</h1>
            <p class="mb-0">Your values-driven daily command center</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('calendar.calendar_view') }}" class="btn btn-light btn-sm">Today</a>
            <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#quickAddModal">
                <i class="bi bi-plus"></i> Quick Add
            </button>
        </div>
    </div>
</div>

<!-- Legend -->
<div class="legend">
    <div class="legend-item">
        <div class="legend-color" style="border-left: 3px solid #3b82f6; background: rgba(255, 255, 255, 0.9);"></div>
        <span>‚óã Tasks</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="border-left: 3px solid #ec4899; background: rgba(255, 255, 255, 0.9);"></div>
        <span>üéØ Goals</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="border-left: 3px solid #f59e0b; background: rgba(255, 255, 255, 0.9);"></div>
        <span>üî• Habits</span>
    </div>
    <div class="legend-item">
        <div class="legend-color" style="border-left: 3px solid #8b5cf6; background: rgba(255, 255, 255, 0.9);"></div>
        <span>üìù Journal</span>
    </div>
</div>

<!-- Calendar Navigation -->
<div class="row align-items-center mb-4">
    <div class="col">
        <a href="{{ url_for('calendar.calendar_view', year=prev_year, month=prev_month) }}" 
           class="btn btn-outline-secondary">
            <i class="bi bi-chevron-left"></i> Previous
        </a>
    </div>
    <div class="col text-center">
        <h2>{{ month_name }} {{ year }}</h2>
    </div>
    <div class="col text-end">
        <a href="{{ url_for('calendar.calendar_view', year=next_year, month=next_month) }}" 
           class="btn btn-outline-secondary">
            Next <i class="bi bi-chevron-right"></i>
        </a>
    </div>
</div>

<!-- Calendar Grid -->
<div class="card">
    <div class="card-body p-0">
        <table class="table table-bordered mb-0 calendar-table">
            <thead>
                <tr class="bg-light">
                    <th class="text-center">Sun</th>
                    <th class="text-center">Mon</th>
                    <th class="text-center">Tue</th>
                    <th class="text-center">Wed</th>
                    <th class="text-center">Thu</th>
                    <th class="text-center">Fri</th>
                    <th class="text-center">Sat</th>
                </tr>
            </thead>
            <tbody>
                {% for week in month_calendar %}
                <tr>
                    {% for day in week %}
                    {% set day_date = date(year, month, day if day > 0 else 1) %}
                    {% set is_today = (day_date == today) %}
                    {% set day_str = day_date.strftime('%Y-%m-%d') %}
                    {% set day_data = calendar_data.get(day_str, {}) %}
                    
                    <td class="calendar-cell 
                        {% if day == 0 %}other-month{% endif %}
                        {% if is_today %}today{% endif %}"
                        data-date="{{ day_str }}">
                        
                        {% if day != 0 %}
                            <!-- Day Number -->
                            <div class="day-number">{{ day }}</div>
                            
                            <!-- Mood Indicator -->
                            {% if day_data.get('mood_avg') %}
                                {% set mood = day_data.mood_avg %}
                                <div class="mood-indicator 
                                    {% if mood >= 8 %}mood-great
                                    {% elif mood >= 6 %}mood-good
                                    {% elif mood >= 4 %}mood-okay
                                    {% elif mood >= 2 %}mood-poor
                                    {% else %}mood-bad{% endif %}"></div>
                            {% endif %}
                            
                            <!-- Day Activities - Google Calendar Style -->
                            <div class="day-activities">
                                {% set all_activities = [] %}
                                
                                <!-- Collect all activities -->
                                {% for task in day_data.get('tasks', []) %}
                                    {% set _ = all_activities.append({
                                        'type': 'task',
                                        'title': task.title,
                                        'completed': task.completed,
                                        'id': task.id,
                                        'energy': task.get_energy_icon(),
                                        'url': url_for('tasks.task_detail', task_id=task.id),
                                        'priority': 1 if not task.completed else 3
                                    }) %}
                                {% endfor %}
                                
                                {% for goal in day_data.get('goals', []) %}
                                    {% set _ = all_activities.append({
                                        'type': 'goal',
                                        'title': 'Goal: ' + goal.title,
                                        'progress': goal.progress,
                                        'id': goal.id,
                                        'url': url_for('goals.view_goal', goal_id=goal.id),
                                        'priority': 0
                                    }) %}
                                {% endfor %}
                                
                                {% if day_data.get('habits_completed', 0) > 0 %}
                                    {% set _ = all_activities.append({
                                        'type': 'habit',
                                        'title': day_data.habits_completed|string + ' habit(s) completed',
                                        'url': url_for('habits.habits_dashboard'),
                                        'priority': 2
                                    }) %}
                                {% endif %}
                                
                                {% for entry in day_data.get('journal_entries', [])[:1] %}
                                    {% set _ = all_activities.append({
                                        'type': 'journal',
                                        'title': 'Journal entry',
                                        'mood': entry.get_mood_emoji() if entry.mood_score else '',
                                        'url': url_for('journal.journal'),
                                        'priority': 2
                                    }) %}
                                {% endfor %}
                                
                                <!-- Sort by priority and display -->
                                {% set sorted_activities = all_activities|sort(attribute='priority') %}
                                {% for activity in sorted_activities[:4] %}
                                <div class="cal-activity cal-{{ activity.type }} {{ 'completed' if activity.get('completed') else '' }}"
                                     onclick="handleActivityClick(event, '{{ activity.url }}', {{ activity.get('id', 0) }}, '{{ activity.type }}')"
                                     title="{{ activity.title }}"
                                     data-activity-id="{{ activity.get('id', 0) }}"
                                     data-activity-type="{{ activity.type }}">
                                    <div class="cal-activity-content">
                                        {% if activity.type == 'task' %}
                                            <span class="cal-check {{ 'checked' if activity.completed else '' }}">
                                                {% if activity.completed %}‚úì {% else %}‚óã {% endif %}
                                            </span>
                                            <span class="cal-text">{{ activity.title[:20] }}{% if activity.title|length > 20 %}...{% endif %}</span>
                                        {% elif activity.type == 'goal' %}
                                            <span class="cal-icon">üéØ</span>
                                            <span class="cal-text">{{ activity.title[:18] }}{% if activity.title|length > 18 %}...{% endif %}</span>
                                            <span class="cal-progress">{{ activity.progress }}%</span>
                                        {% elif activity.type == 'habit' %}
                                            <span class="cal-icon">üî•</span>
                                            <span class="cal-text">{{ activity.title }}</span>
                                        {% elif activity.type == 'journal' %}
                                            <span class="cal-icon">{{ activity.mood or 'üìù' }}</span>
                                            <span class="cal-text">{{ activity.title }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                                
                                <!-- Show "more" indicator -->
                                {% if all_activities|length > 4 %}
                                <div class="cal-more" onclick="showDayDetails('{{ day_str }}')" title="Click to see all activities">
                                    +{{ all_activities|length - 4 }} more...
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Quick Actions (on hover) -->
                            <div class="quick-actions">
                                <button class="quick-btn" title="Add task" onclick="quickAddTask('{{ day_str }}')">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Quick Add Modal -->
<div class="modal fade" id="quickAddModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Quick Add</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Add to:</label>
                    <select class="form-select" id="addType">
                        <option value="task">Task</option>
                        <option value="habit">Habit Check-in</option>
                        <option value="journal">Journal Entry</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label">Date:</label>
                    <input type="date" class="form-control" id="quickDate" value="{{ today.isoformat() }}">
                </div>
                <div class="mb-3">
                    <label class="form-label">Content:</label>
                    <input type="text" class="form-control" id="quickContent" placeholder="Enter details...">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="quickAdd()">
                    <span class="add-text">Add</span>
                    <span class="add-spinner d-none">
                        <span class="spinner-border spinner-border-sm me-2"></span>Adding...
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Day Detail Modal -->
<div class="modal fade" id="dayDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="dayDetailTitle">Day Overview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="dayDetailContent">
                <!-- Dynamic content loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="openQuickAddForDate()">
                    <i class="bi bi-plus"></i> Add Item
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let selectedDate = null;

// Enhanced quick add functionality
async function quickAdd() {
    const type = document.getElementById('addType').value;
    const date = document.getElementById('quickDate').value;
    const content = document.getElementById('quickContent').value;
    
    if (!content.trim()) {
        showToast('Please enter some content', 'warning');
        return;
    }
    
    // Show loading state
    toggleAddButtonLoading(true);
    
    try {
        let response;
        if (type === 'task') {
            response = await fetch('/api/quick-task', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    title: content,
                    energy: 'medium',
                    due_date: date
                })
            });
        } else if (type === 'journal') {
            // Create minimal journal entry
            response = await fetch('/journal', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `content=${encodeURIComponent(content)}&mood_score=5`
            });
        } else {
            throw new Error('Habit check-ins not supported via quick add');
        }
        
        if (response.ok) {
            showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} added successfully!`, 'success');
            document.getElementById('quickContent').value = '';
            bootstrap.Modal.getInstance(document.getElementById('quickAddModal')).hide();
            // Reload calendar to show new item
            setTimeout(() => location.reload(), 1000);
        } else {
            throw new Error('Failed to add item');
        }
    } catch (error) {
        console.error('Error adding item:', error);
        showToast('Error adding item. Please try again.', 'error');
    } finally {
        toggleAddButtonLoading(false);
    }
}

// Show day detail modal with enhanced content
async function showDayDetails(dateStr) {
    selectedDate = dateStr;
    const modal = new bootstrap.Modal(document.getElementById('dayDetailModal'));
    const title = document.getElementById('dayDetailTitle');
    const content = document.getElementById('dayDetailContent');
    
    // Format date nicely
    const date = new Date(dateStr + 'T00:00:00');
    const formattedDate = date.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    title.textContent = formattedDate;
    content.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"></div><p>Loading day details...</p></div>';
    modal.show();
    
    try {
        // Fetch day data (you'd implement this API endpoint)
        const response = await fetch(`/api/calendar/date/${dateStr}`);
        if (response.ok) {
            const data = await response.json();
            renderDayContent(data);
        } else {
            throw new Error('Failed to load day data');
        }
    } catch (error) {
        console.error('Error loading day details:', error);
        content.innerHTML = `
            <div class="alert alert-warning">
                <h6>Day Overview</h6>
                <p>Unable to load detailed information. Click "Add Item" to add content for this day.</p>
            </div>`;
    }
}

// Render day content in modal
function renderDayContent(data) {
    const content = document.getElementById('dayDetailContent');
    let html = '';
    
    // Tasks section
    if (data.tasks && data.tasks.length > 0) {
        html += '<div class="mb-4"><h6><i class="bi bi-check-circle"></i> Tasks</h6>';
        data.tasks.forEach(task => {
            html += `<div class="d-flex align-items-center mb-2">
                <input type="checkbox" ${task.completed ? 'checked disabled' : ''} class="form-check-input me-2">
                <span class="${task.completed ? 'text-muted text-decoration-line-through' : ''}">${task.title}</span>
            </div>`;
        });
        html += '</div>';
    }
    
    // Habits section
    if (data.habits_completed && data.habits_completed > 0) {
        html += `<div class="mb-4"><h6><i class="bi bi-repeat"></i> Habits</h6>
                 <p class="text-success">${data.habits_completed} habit(s) completed! üéâ</p></div>`;
    }
    
    // Journal section
    if (data.journal_entries && data.journal_entries.length > 0) {
        html += '<div class="mb-4"><h6><i class="bi bi-journal-text"></i> Journal</h6>';
        data.journal_entries.forEach(entry => {
            const moodEmoji = entry.mood_score >= 7 ? 'üòä' : entry.mood_score >= 5 ? 'üòê' : 'üòî';
            html += `<div class="card card-body bg-light mb-2">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <small class="text-muted">Journal Entry</small>
                    <span>${moodEmoji} ${entry.mood_score}/10</span>
                </div>
                <p class="mb-0">${entry.content.substring(0, 200)}${entry.content.length > 200 ? '...' : ''}</p>
            </div>`;
        });
        html += '</div>';
    }
    
    if (!html) {
        html = `<div class="alert alert-info">
            <h6>No activities yet</h6>
            <p>This day is free! Click "Add Item" to plan something.</p>
        </div>`;
    }
    
    content.innerHTML = html;
}

// Open quick add for specific date
function openQuickAddForDate() {
    bootstrap.Modal.getInstance(document.getElementById('dayDetailModal')).hide();
    if (selectedDate) {
        document.getElementById('quickDate').value = selectedDate;
    }
    new bootstrap.Modal(document.getElementById('quickAddModal')).show();
}

// Enhanced calendar day interactions
function enableDayClickInteraction() {
    document.querySelectorAll('.calendar-day[data-date]').forEach(day => {
        // Add hover effects
        day.style.transition = 'all 0.2s ease';
        
        day.addEventListener('mouseenter', function() {
            if (!this.classList.contains('other-month')) {
                this.style.transform = 'scale(1.02)';
                this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
            }
        });
        
        day.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.boxShadow = 'none';
        });
        
        // Click handler for day details
        day.addEventListener('click', function() {
            const dateStr = this.getAttribute('data-date');
            if (dateStr && !this.classList.contains('other-month')) {
                showDayDetails(dateStr);
            }
        });
    });
}

// Toggle loading state for add button
function toggleAddButtonLoading(isLoading) {
    const textSpan = document.querySelector('.add-text');
    const spinnerSpan = document.querySelector('.add-spinner');
    const button = textSpan.closest('button');
    
    if (isLoading) {
        textSpan.classList.add('d-none');
        spinnerSpan.classList.remove('d-none');
        button.disabled = true;
    } else {
        textSpan.classList.remove('d-none');
        spinnerSpan.classList.add('d-none');
        button.disabled = false;
    }
}

// Toast notification system
function showToast(message, type = 'info') {
    // Create toast element
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'primary'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">${message}</div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;
    
    // Add to toast container (create if doesn't exist)
    let container = document.getElementById('toast-container');
    if (!container) {
        container = document.createElement('div');
        container.id = 'toast-container';
        container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(container);
    }
    
    container.insertAdjacentHTML('beforeend', toastHtml);
    const toast = new bootstrap.Toast(container.lastElementChild);
    toast.show();
    
    // Remove element after it's hidden
    container.lastElementChild.addEventListener('hidden.bs.toast', function() {
        this.remove();
    });
}

// Handle activity clicks with improved navigation
function handleActivityClick(event, url, activityId, activityType) {
    // Prevent click when clicking on a task checkbox
    if (event.target.classList.contains('cal-check') && activityType === 'task') {
        event.stopPropagation();
        toggleTaskFromCalendar(activityId);
        return;
    }
    
    // Navigate to the appropriate page
    window.location.href = url;
}

// Toggle task completion directly from calendar
async function toggleTaskFromCalendar(taskId) {
    try {
        const response = await fetch(`/api/calendar/task/${taskId}/toggle`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
            const data = await response.json();
            showToast(data.message, 'success');
            
            // Update UI immediately
            const taskElement = document.querySelector(`[onclick*="task"][onclick*="${taskId}"]`);
            if (taskElement) {
                const checkElement = taskElement.querySelector('.cal-check');
                const textElement = taskElement.querySelector('.cal-text');
                
                if (data.completed) {
                    taskElement.classList.add('completed');
                    checkElement.textContent = '‚úì ';
                    checkElement.classList.add('checked');
                    textElement.style.textDecoration = 'line-through';
                } else {
                    taskElement.classList.remove('completed');
                    checkElement.textContent = '‚óã ';
                    checkElement.classList.remove('checked');
                    textElement.style.textDecoration = 'none';
                }
            }
        } else {
            throw new Error('Failed to toggle task');
        }
    } catch (error) {
        console.error('Error toggling task:', error);
        showToast('Error updating task. Please try again.', 'error');
    }
}

// Enhanced interaction effects
function addCalendarEnhancements() {
    // Add smooth animations to activity items
    document.querySelectorAll('.activity-item').forEach(item => {
        item.style.transition = 'all 0.2s ease-in-out';
        
        // Hover effects
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
            this.style.filter = 'brightness(1.1)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
            this.style.filter = 'brightness(1)';
        });
    });
    
    // Add pulse animation to today's cell
    const today = document.querySelector('.calendar-day.today');
    if (today) {
        today.style.animation = 'pulse 2s infinite';
    }
}

// Add CSS animations
const calendarStyle = document.createElement('style');
calendarStyle.textContent = `
    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(102, 126, 234, 0); }
        100% { box-shadow: 0 0 0 0 rgba(102, 126, 234, 0); }
    }
    
    .activity-item {
        cursor: pointer;
    }
    
    .activity-item.completed {
        opacity: 0.7;
        background: linear-gradient(45deg, #22c55e, #16a34a) !important;
    }
    
    .calendar-day:hover {
        cursor: pointer;
    }
`;
document.head.appendChild(calendarStyle);

// Initialize calendar interactions when page loads
document.addEventListener('DOMContentLoaded', function() {
    enableDayClickInteraction();
    addCalendarEnhancements();
});
</script>
{% endblock %}